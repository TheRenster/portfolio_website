name: Streamlit keepalive

on:
  schedule:
    # Every 10 minutes
    - cron: "*/10 * * * *"
  workflow_dispatch: {}

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Ping Streamlit apps (lightweight)
        run: |
          set -euo pipefail
          urls=(
            "https://clarity-context-app.streamlit.app/?ping=true"
            "https://lauren-knox-portfolio.streamlit.app/?ping=true"
            "https://deep-forecasting-renster.streamlit.app/?ping=true"
          )
          for url in "${urls[@]}"; do
            echo "Pinging: $url"
            # Streamlit often redirects through an auth/cookie flow even for public apps.
            # Use a cookie jar + browser UA to avoid redirect loops.
            cookie_jar="$(mktemp)"
            curl -sS -L \
              -A "Mozilla/5.0" \
              -c "$cookie_jar" -b "$cookie_jar" \
              --max-time 60 \
              -o /dev/null \
              -w "HTTP %{http_code} -> %{url_effective}\n" \
              "$url" || true
          done
